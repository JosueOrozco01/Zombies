@startuml
' Diagrama de Secuencia: Creación y Gestión de Efectos (refactor)
actor Jugador
participant "PersonajeRefactor" as P
participant "CompositionRoot" as CRoot
participant "DefaultGameObjectFactory" as Factory
participant "DefaultParticulaFactory" as PF
participant "CoroutineRunner" as CR

Jugador -> P: Dispara
activate P

P -> CRoot: Resolve.ParticulaFactory()
activate CRoot
CRoot --> P: IParticulaFactory
deactivate CRoot

P -> PF: EmitirParticula(pos, rot, 2f)
activate PF

PF -> PF: Instantiate(prefab)
PF -> CR: Run(DestroyAfterDelay)
activate CR
CR --> PF: routine
deactivate CR

PF --> P: particula
deactivate PF

P -> CRoot: Resolve.ExplosionFactory()
activate CRoot
CRoot --> P: IExplosionFactory
deactivate CRoot

P -> Factory: CrearExplosion(pos, rot)
activate Factory
Factory --> P: explosion
deactivate Factory

deactivate P

@enduml